# Custom Order Quote to Checkout - Visual Flow

## User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DASHBOARD - CUSTOM ORDERS                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ğŸ“‹ CUSTOM-2025-00123                                            â”‚
â”‚  â”œâ”€ Description: Navy Blue Costume                               â”‚
â”‚  â”œâ”€ Status: [Chat in progress]                                  â”‚
â”‚  â””â”€ [View Chat]                                                  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                         Click [View Chat]
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CHAT MODAL                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Admin: "For 5 navy costumes at â‚¦15,000 each"                   â”‚
â”‚  Admin: "With 10% bulk discount"                                â”‚
â”‚  Admin: "Final price: â‚¦67,500"                                  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ âœ“ Final Price                       â”‚                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚  â”‚ Unit Price:          â‚¦15,000        â”‚                        â”‚
â”‚  â”‚ Discount (10%):      -â‚¦7,500        â”‚                        â”‚
â”‚  â”‚ VAT (7.5%):          â‚¦4,500         â”‚                        â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                        â”‚
â”‚  â”‚ Total:               â‚¦67,500        â”‚                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚  â”‚    [ğŸ’µ Pay Now]  [â† Back to Chat]   â”‚  â† NEW!               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                      Click [ğŸ’µ Pay Now]
                                â†“
    sessionStorage.setItem('customOrderQuote', {...})
                                â†“
              router.push('/checkout?fromQuote=true')
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHECKOUT PAGE (Quote Mode)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  [Order Review - Step 2 of 2]                                   â”‚
â”‚                                                                   â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“                         â”‚
â”‚  â”ƒ ğŸ“„ Custom Order Quote (NEW!)      â”ƒ                         â”‚
â”‚  â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«                         â”‚
â”‚  â”ƒ Order: CUSTOM-2025-00123          â”ƒ                         â”‚
â”‚  â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«                         â”‚
â”‚  â”ƒ Unit Price:     â‚¦15,000            â”ƒ                         â”‚
â”‚  â”ƒ Discount (10%): -â‚¦7,500            â”ƒ                         â”‚
â”‚  â”ƒ VAT (7.5%):     â‚¦4,500             â”ƒ                         â”‚
â”‚  â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«                         â”‚
â”‚  â”ƒ TOTAL:          â‚¦67,500            â”ƒ                         â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›                         â”‚
â”‚                                                                   â”‚
â”‚  [Billing Information]                                          â”‚
â”‚  [Delivery Information] (if EMPI delivery)                      â”‚
â”‚                                                                   â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                                        â”‚  Quote Summary       â”‚ â”‚
â”‚                                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚                                        â”‚ Order: CUSTOM-2025.. â”‚ â”‚
â”‚                                        â”‚ Qty: 5               â”‚ â”‚
â”‚                                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚                                        â”‚ Unit:   â‚¦15,000      â”‚ â”‚
â”‚                                        â”‚ Disc:   -â‚¦7,500      â”‚ â”‚
â”‚                                        â”‚ VAT:    â‚¦4,500       â”‚ â”‚
â”‚                                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚                                        â”‚ Total:  â‚¦67,500      â”‚ â”‚
â”‚                                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚                                        â”‚ âœ… Ready for Pay     â”‚ â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  [Back to Cart]  [Pay â‚¦67,500 with Paystack]                   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                    Click [Pay â‚¦67,500 with Paystack]
                                â†“
                    Paystack Payment Gateway
                                â†“
                         Payment Successful
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Payment Success Modal                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚                    âœ… PAYMENT SUCCESSFUL                         â”‚
â”‚                                                                   â”‚
â”‚              Reference: flw_xxxxxxxxxxxxxxx                      â”‚
â”‚              Amount: â‚¦67,500                                     â”‚
â”‚                                                                   â”‚
â”‚              Order Status Updated to "PAID"                      â”‚
â”‚              Invoice Generated                                   â”‚
â”‚                                                                   â”‚
â”‚                    [Continue Shopping]                          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                 sessionStorage.removeItem('customOrderQuote')
                                â†“
                   custom_order.status = "PAID"
                   custom_order.paymentReference = "flw_xxx"
                   custom_order.paidAt = ISO timestamp
                                â†“
                    Dashboard Updates Automatically
```

---

## Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ChatModal Component                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  onAdmin sends quote message (isFinalPrice = true)               â”‚
â”‚         â†“                                                         â”‚
â”‚  Display message with calculation:                              â”‚
â”‚    - Unit Price                                                 â”‚
â”‚    - Discount Amount (if any)                                  â”‚
â”‚    - VAT                                                        â”‚
â”‚    - Total                                                      â”‚
â”‚         â†“                                                        â”‚
â”‚  Render "âœ“ Final Price" badge                                  â”‚
â”‚         â†“                                                        â”‚
â”‚  IF customer (not admin):                                       â”‚
â”‚    â””â”€ Render "Pay Now" button                                  â”‚
â”‚         â†“                                                        â”‚
â”‚  ON "Pay Now" click:                                            â”‚
â”‚    â”œâ”€ Extract quote data from message                          â”‚
â”‚    â”œâ”€ Create quote object:                                     â”‚
â”‚    â”‚  {                                                         â”‚
â”‚    â”‚    orderId,                                               â”‚
â”‚    â”‚    orderNumber,                                           â”‚
â”‚    â”‚    quotedPrice,                                           â”‚
â”‚    â”‚    quantity,                                              â”‚
â”‚    â”‚    discountPercentage,                                    â”‚
â”‚    â”‚    discountAmount,                                        â”‚
â”‚    â”‚    quotedVAT,                                             â”‚
â”‚    â”‚    quotedTotal                                            â”‚
â”‚    â”‚  }                                                         â”‚
â”‚    â”œâ”€ sessionStorage.setItem('customOrderQuote', JSON)         â”‚
â”‚    â””â”€ router.push('/checkout?fromQuote=true')                  â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Checkout Page Component                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  ON MOUNT (useEffect):                                           â”‚
â”‚    â”œâ”€ Get 'customOrderQuote' from sessionStorage                â”‚
â”‚    â”œâ”€ IF data exists:                                           â”‚
â”‚    â”‚  â”œâ”€ Parse JSON                                            â”‚
â”‚    â”‚  â”œâ”€ setCustomOrderQuote(data)                             â”‚
â”‚    â”‚  â””â”€ setIsFromQuote(true)                                  â”‚
â”‚    â””â”€ ELSE:                                                     â”‚
â”‚       â””â”€ isFromQuote remains false                             â”‚
â”‚         â†“                                                        â”‚
â”‚  IF isFromQuote:                                                â”‚
â”‚    â”œâ”€ MAIN CONTENT:                                            â”‚
â”‚    â”‚  â””â”€ Display Custom Order Quote Card (lime themed)         â”‚
â”‚    â”‚     â”œâ”€ Order number                                       â”‚
â”‚    â”‚     â”œâ”€ Unit price                                         â”‚
â”‚    â”‚     â”œâ”€ Discount (if applicable)                          â”‚
â”‚    â”‚     â”œâ”€ VAT                                                â”‚
â”‚    â”‚     â””â”€ Total                                              â”‚
â”‚    â”‚                                                            â”‚
â”‚    â””â”€ SIDEBAR:                                                 â”‚
â”‚       â”œâ”€ Title: "Quote Summary"                               â”‚
â”‚       â”œâ”€ Quote Details                                        â”‚
â”‚       â”œâ”€ Pricing Breakdown                                    â”‚
â”‚       â””â”€ Total Amount: quotedTotal                            â”‚
â”‚  ELSE:                                                          â”‚
â”‚    â”œâ”€ MAIN CONTENT:                                            â”‚
â”‚    â”‚  â””â”€ Display cart items                                    â”‚
â”‚    â”‚                                                            â”‚
â”‚    â””â”€ SIDEBAR:                                                 â”‚
â”‚       â””â”€ Regular Order Summary                                 â”‚
â”‚         â†“                                                        â”‚
â”‚  ON PAYMENT SUCCESS:                                            â”‚
â”‚    IF isFromQuote && customOrderQuote:                         â”‚
â”‚    â”œâ”€ Send POST to /api/custom-orders/update-payment         â”‚
â”‚    â”œâ”€ Generate invoice with type: 'custom_order'             â”‚
â”‚    â”œâ”€ Link invoice to customOrderId                           â”‚
â”‚    â”œâ”€ Show success modal                                       â”‚
â”‚    â””â”€ sessionStorage.removeItem('customOrderQuote')           â”‚
â”‚    ELSE:                                                        â”‚
â”‚    â””â”€ Standard cart checkout flow                             â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Persistence Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    sessionStorage Flow                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ChatModal.tsx - handlePayNow()                             â”‚
â”‚  â”œâ”€ Create quote object                                    â”‚
â”‚  â””â”€ sessionStorage.setItem('customOrderQuote', JSON.stringify(quoteData))
â”‚                                                              â”‚
â”‚  â†“ (Tab stays open, user navigates to /checkout)          â”‚
â”‚                                                              â”‚
â”‚  checkout/page.tsx - useEffect()                            â”‚
â”‚  â”œâ”€ const quoteData = sessionStorage.getItem('customOrderQuote')
â”‚  â”œâ”€ Parse JSON                                             â”‚
â”‚  â””â”€ setCustomOrderQuote(quoteData)                         â”‚
â”‚                                                              â”‚
â”‚  â†“ (User completes payment)                                â”‚
â”‚                                                              â”‚
â”‚  checkout/page.tsx - handlePaymentSuccess()                â”‚
â”‚  â”œâ”€ Process quote payment                                  â”‚
â”‚  â””â”€ sessionStorage.removeItem('customOrderQuote')         â”‚
â”‚                                                              â”‚
â”‚  â†“ (sessionStorage cleared)                                â”‚
â”‚                                                              â”‚
â”‚  If user closes tab or refreshes mid-checkout:             â”‚
â”‚  â””â”€ Quote data lost (safe, prevents duplicate payments)   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Color Theme Reference

### Quote Components (Lime/Green Theme)

```
Quote Card:
â”œâ”€ Background: from-lime-50 to-green-50
â”œâ”€ Border: lime-300
â””â”€ Text: gray-900

Quote Total Display:
â”œâ”€ Background: from-lime-100 to-green-100
â”œâ”€ Border: lime-400
â””â”€ Text: from-lime-600 to-green-600 (gradient)

Unit Price Section:
â”œâ”€ Background: white/60
â””â”€ Border: lime-200

Discount Section (if applicable):
â”œâ”€ Background: green-50
â””â”€ Border: green-200

VAT Section:
â”œâ”€ Background: blue-50
â””â”€ Border: blue-200
```

---

## State Management Summary

### ChatModal State
```tsx
const router = useRouter();           // Navigation
const buyer = useBuyer();             // User context

// No new state variables needed
// Uses existing order and message state
```

### Checkout State
```tsx
const [customOrderQuote, setCustomOrderQuote] = useState<any>(null);
const [isFromQuote, setIsFromQuote] = useState(false);

// Used to determine which UI to display
// Controls payment flow logic
```

---

## Security & Best Practices

âœ… **Secure Data Passing**
- Uses sessionStorage (auto-clears on tab close)
- Not vulnerable to page refresh (user returned to checkout flow)

âœ… **Error Handling**
- Try-catch for JSON parsing
- Fallback values for missing amounts
- Graceful handling of API failures

âœ… **Authorization**
- "Pay Now" button only shows to customers (not admins)
- Quote linked to buyerId for tracking

âœ… **Data Validation**
- Server-side validation when processing payment
- Custom order record verified before status update

âœ… **Audit Trail**
- paymentReference stored for tracking
- Invoice created for accounting
- Order status updated with timestamp
