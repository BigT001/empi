generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Product {
  id                String   @id @default(cuid())
  name              String
  description       String   @db.Text
  sellPrice         Float
  rentPrice         Float    @default(0)
  category          String   // "adults" or "kids"
  badge             String?
  image             String   // Main image (base64 or URL)
  images            String[]  // Array of images (base64 or URLs)
  
  // Product details
  sizes             String?   // Comma-separated sizes
  color             String?
  material          String?
  condition         String?
  careInstructions  String?   @db.Text
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  orderItems        OrderItem[]

  @@map("products")
}

model Order {
  id                String   @id @default(cuid())
  orderNumber       String   @unique @default(cuid())
  
  // Customer info
  firstName         String
  lastName          String
  email             String
  phone             String?
  address           String?
  busStop           String?   // For EMPI delivery
  city              String?
  state             String?
  zipCode           String?
  country           String
  
  // Shipping & Payment
  shippingType      String    // "self" or "handled"
  shippingCost      Float     @default(0)
  subtotal          Float
  total             Float
  paymentMethod     String    // "card" or "bank"
  status            String    @default("confirmed")
  
  items             OrderItem[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@map("orders")
}

model OrderItem {
  id          String  @id @default(cuid())
  orderId     String  @map("order_id")
  order       Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  productId   String  @map("product_id")
  product     Product @relation(fields: [productId], references: [id])
  
  name        String
  quantity    Int
  price       Float
  rentPrice   Float?
  mode        String  // "buy" or "rent"
  selectedSize String?
  rentalDays  Int     @default(0)
  
  @@map("order_items")
}

model Cart {
  id          String  @id @default(cuid())
  sessionId   String  @unique @map("session_id")
  
  items       CartItem[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("carts")
}

model CartItem {
  id        String  @id @default(cuid())
  cartId    String  @map("cart_id")
  cart      Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  
  productId String
  name      String
  quantity  Int
  price     Float
  rentPrice Float?
  mode      String  // "buy" or "rent"
  selectedSize String?
  rentalDays Int @default(0)
  image     String  @db.Text
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("cart_items")
}
